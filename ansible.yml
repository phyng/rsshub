
---

- hosts: do
  remote_user: phyng
  become: yes
  vars:
    git_version: "master"
    project_root: "/home/phyng/project/rsshub"
    port: 8002
  tasks:

    - name: pull repo
      git:
        repo: https://github.com/phyng/rsshub.git
        dest: "{{ project_root }}"
        version: "{{ git_version }}"

    - name: create virtualenv
      pip:
        requirements: '{{ project_root }}/requirements.txt'
        virtualenv: '{{ project_root }}/env'

    - name: copy server_settings
      copy:
        src: "./rsshub/server_settings.py"
        dest: "{{ project_root }}/rsshub/server_settings.py"
        owner: root
        group: root
        mode: "u=rx,g=r,o=r"

    - name: restart supervisor
      supervisorctl: name=rsshub state=restarted config=./supervisord.conf
